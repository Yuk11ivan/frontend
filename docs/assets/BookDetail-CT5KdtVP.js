import{_ as a,p as e,r as t,e as l,c as s,a as o,d as r,l as n,b as i,t as d,n as u,F as c,f as v,w as p,j as k,v as h,u as b,o as g}from"./index-LEf4sZUU.js";import{g as w,a as m,b as y}from"./api-CtTze4QI.js";const C={class:"book-detail-container"},f={key:0,class:"loading-container"},j={key:1,class:"book-detail-content"},D={class:"detail-main"},M={class:"book-cover-large"},x={key:0,class:"status-badge-large"},H={class:"book-info-detail"},A={class:"book-title-detail"},B={class:"book-author-detail"},I={class:"book-meta"},L={class:"meta-item"},S={class:"meta-value"},$={class:"meta-item"},_={class:"meta-value"},V={class:"meta-item"},F={key:0,class:"meta-item description"},K={class:"meta-value"},z={class:"action-section"},N={key:1,class:"action-button disabled large",disabled:""},T={key:0,class:"borrow-records-section"},U={class:"records-table-container"},Z={class:"records-table"},q={key:2,class:"error-container"},E={class:"dialog-content"},G={class:"dialog-body"},J={class:"form-group"},O={key:0,class:"error-message"},P={class:"dialog-footer"},Q=["disabled"],R=a({__name:"BookDetail",setup(a){const R=e(),W=b(),X=R.params.id,Y=t(null),aa=t([]),ea=t(!0),ta=t(!1),la=t(""),sa=t(""),oa=t(""),ra=t("success"),na=async()=>{try{ea.value=!0,va("正在加载图书信息...","info");const e=await w(X);e&&e.id?Y.value=e:(Y.value={id:parseInt(X),code:`BK${String(parseInt(X)).padStart(3,"0")}`,title:`图书 #${X}`,author:"未知作者",status:"available",category:{name:"未分类"},description:"该图书暂无详细信息",createdAt:new Date,updatedAt:new Date},va("加载的图书数据不完整，显示默认信息","warning"));try{const a=await m(X);aa.value=Array.isArray(a)?a:[]}catch(a){console.warn("获取借阅记录失败，将显示为空",a),aa.value=[]}va("图书信息加载成功","success")}catch(e){console.error("加载图书详情失败:",e),Y.value={id:parseInt(X),code:`BK${String(parseInt(X)).padStart(3,"0")}`,title:`图书 #${X}`,author:"未知作者",status:"available",category:{name:"未分类"},description:"加载图书信息时发生错误",createdAt:new Date,updatedAt:new Date},aa.value=[],va("加载图书详情时发生错误，但已显示默认信息","error")}finally{ea.value=!1}},ia=()=>{ta.value=!0,la.value="",sa.value=""},da=()=>{ta.value=!1,la.value="",sa.value=""},ua=async()=>{var a,e,t;if((t=la.value)?/^1[3-9]\d{9}$/.test(t)?(sa.value="",1):(sa.value="请输入有效的11位手机号",0):(sa.value="请输入手机号",0))try{await y(X,la.value),va("借阅成功"),da(),await na()}catch(l){va("借阅失败: "+((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"未知错误"),"error"),console.error("Failed to borrow book:",l)}},ca=a=>{if(!a)return"";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},va=(a,e="success")=>{oa.value=a,ra.value=e;setTimeout(()=>{oa.value=""},"error"===e?5e3:"warning"===e?4e3:3e3)},pa=()=>{W.back()};return l(()=>{na()}),(a,e)=>{var t;return g(),s("div",C,[o("div",{class:"detail-header"},[o("button",{class:"back-button",onClick:pa},[...e[1]||(e[1]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M19 12H5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),o("path",{d:"M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),n(" 返回列表 ",-1)])])]),ea.value?(g(),s("div",f,[...e[2]||(e[2]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"加载中...",-1)])])):Y.value?(g(),s("div",j,[o("div",D,[o("div",M,[e[3]||(e[3]=i('<div class="book-icon-large" data-v-42c8dba4><svg width="120" height="120" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-42c8dba4><path d="M9 7H39C40.6569 7 42 8.34315 42 10V38C42 39.6569 40.6569 41 39 41H9C7.34315 41 6 39.6569 6 38V10C6 8.34315 7.34315 7 9 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-42c8dba4></path><path d="M36 7V41" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-42c8dba4></path><path d="M12 15H36" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-42c8dba4></path><path d="M12 21H36" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-42c8dba4></path><path d="M12 27H30" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-42c8dba4></path><path d="M12 33H24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-42c8dba4></path></svg></div>',1)),"borrowed"===Y.value.status?(g(),s("div",x,"已借出")):r("",!0)]),o("div",H,[o("h1",A,d(Y.value.title),1),o("p",B,"作者: "+d(Y.value.author),1),o("div",I,[o("div",L,[e[4]||(e[4]=o("span",{class:"meta-label"},"分类:",-1)),o("span",S,d((null==(t=Y.value.category)?void 0:t.name)||"未分类"),1)]),o("div",$,[e[5]||(e[5]=o("span",{class:"meta-label"},"图书编码:",-1)),o("span",_,d(Y.value.code),1)]),o("div",V,[e[6]||(e[6]=o("span",{class:"meta-label"},"状态:",-1)),o("span",{class:u(["meta-value","status-"+Y.value.status])},d("available"===Y.value.status?"可借阅":"已借出"),3)]),Y.value.description?(g(),s("div",F,[e[7]||(e[7]=o("span",{class:"meta-label"},"描述:",-1)),o("span",K,d(Y.value.description),1)])):r("",!0)]),o("div",z,["available"===Y.value.status?(g(),s("button",{key:0,class:"action-button primary large",onClick:ia}," 立即借阅 ")):(g(),s("button",N," 已被借出 "))])])]),aa.value&&aa.value.length>0?(g(),s("div",T,[e[9]||(e[9]=o("h2",null,"借阅记录",-1)),o("div",U,[o("table",Z,[e[8]||(e[8]=o("thead",null,[o("tr",null,[o("th",null,"借阅人手机号"),o("th",null,"借阅时间"),o("th",null,"归还时间"),o("th",null,"状态")])],-1)),o("tbody",null,[(g(!0),s(c,null,v(aa.value,a=>(g(),s("tr",{key:a.id},[o("td",null,d(a.phone),1),o("td",null,d(ca(a.borrowDate)),1),o("td",null,d(a.returnDate?ca(a.returnDate):"-"),1),o("td",{class:u("status-"+(a.returnDate?"returned":"active"))},d(a.returnDate?"已归还":"借阅中"),3)]))),128))])])])])):r("",!0)])):(g(),s("div",q,[...e[10]||(e[10]=[o("p",null,"未找到该图书信息",-1)])])),ta.value?(g(),s("div",{key:3,class:"dialog-overlay",onClick:p(da,["self"])},[o("div",E,[o("div",{class:"dialog-header"},[e[12]||(e[12]=o("h3",null,"借阅图书",-1)),o("button",{class:"close-button",onClick:da},[...e[11]||(e[11]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),o("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),o("div",G,[o("div",J,[e[13]||(e[13]=o("label",{for:"phone"},"手机号",-1)),k(o("input",{type:"tel",id:"phone","onUpdate:modelValue":e[0]||(e[0]=a=>la.value=a),placeholder:"请输入您的手机号",maxlength:"11"},null,512),[[h,la.value]]),sa.value?(g(),s("span",O,d(sa.value),1)):r("",!0)])]),o("div",P,[o("button",{class:"action-button secondary",onClick:da},"取消"),o("button",{class:"action-button primary",onClick:ua,disabled:!la.value||sa.value},"确认借阅",8,Q)])])])):r("",!0),oa.value?(g(),s("div",{key:4,class:u(["message-toast",ra.value])},d(oa.value),3)):r("",!0)])}}},[["__scopeId","data-v-42c8dba4"]]);export{R as default};
