import{_ as oe,r as u,q as Q,s as se,e as le,c as d,a as e,d as y,l as ae,j as k,v as C,y as Z,F,f as j,b as de,w as S,t as n,n as G,o as i}from"./index-BPoYUc4d.js";import{e as ie,f as re,h as ne,u as ue,i as ce}from"./api-DS5VUnfc.js";const ve={class:"manage-container"},pe={class:"search-bar"},ge=["value"],he={class:"books-content"},ye={key:0,class:"loading-container"},ke={key:1,class:"empty-state"},be={key:2,class:"books-table-wrapper"},fe={class:"books-table"},me={class:"code-cell"},_e={class:"title-cell"},we={class:"author-cell"},Ce={class:"category-cell"},xe={class:"status-cell"},Ie={class:"action-cell"},Be=["onClick"],De=["onClick","disabled"],Me={class:"dialog-content"},Ve={class:"dialog-header"},Le={class:"dialog-body"},Fe={class:"form-group"},je=["disabled"],Se={key:0,class:"error-message"},Ue={class:"form-group"},Ee=["disabled"],Te={key:0,class:"error-message"},He={class:"form-group"},Ne=["disabled"],qe={key:0,class:"error-message"},Ae={class:"form-group"},$e=["disabled"],ze=["value"],Pe={key:0,class:"error-message"},Qe={class:"form-group"},Ze=["disabled"],Ge={class:"dialog-footer"},Je=["disabled"],Ke=["disabled"],Oe={key:0},Re={key:1},We={class:"dialog-content delete-dialog"},Xe={class:"dialog-body"},Ye={class:"warning-text"},et={class:"dialog-footer"},tt=["disabled"],ot=["disabled"],st={key:0},lt={key:1},at={__name:"BookManage",setup(dt){const h=u([]),_=u([]),V=u(!1),b=u(""),x=u(""),I=u(!1),L=u(!1),c=u(!1),p=u(null),f=u(null),g=u(!1),w=u(!1),B=u(""),U=u("success"),o=Q({code:"",title:"",author:"",categoryId:"",description:""}),r=Q({code:"",title:"",author:"",categoryId:""}),J=se(()=>h.value.filter(l=>{var v;const t=!b.value||l.title.toLowerCase().includes(b.value.toLowerCase())||l.author.toLowerCase().includes(b.value.toLowerCase())||l.code.toLowerCase().includes(b.value.toLowerCase()),a=!x.value||((v=l.category)==null?void 0:v.id.toString())===x.value;return t&&a})),K=async()=>{var l,t;try{V.value=!0;const[a,v]=await Promise.all([ie(),re()]);h.value=a,_.value=v}catch(a){m("加载数据失败: "+(((t=(l=a.response)==null?void 0:l.data)==null?void 0:t.message)||"未知错误"),"error"),console.error("Failed to load data:",a)}finally{V.value=!1}},O=()=>{let l=!0;return r.code="",r.title="",r.author="",r.categoryId="",o.code.trim()||(r.code="请输入图书编码",l=!1),o.title.trim()||(r.title="请输入图书名称",l=!1),o.author.trim()||(r.author="请输入作者姓名",l=!1),o.categoryId||(r.categoryId="请选择分类",l=!1),l},R=()=>{c.value=!1,p.value=null,T(),I.value=!0},W=l=>{var t;c.value=!0,p.value=l,o.code=l.code,o.title=l.title,o.author=l.author,o.categoryId=((t=l.category)==null?void 0:t.id)||"",o.description=l.description||"",H(),I.value=!0},D=()=>{I.value=!1,T(),H()},X=l=>{f.value=l,L.value=!0},M=()=>{L.value=!1,f.value=null},Y=async()=>{var l,t;if(O())try{if(g.value=!0,c.value&&p.value){await ue(p.value.id,{code:o.code,title:o.title,author:o.author,categoryId:o.categoryId,description:o.description}),m("图书信息更新成功");const a=h.value.findIndex(v=>v.id===p.value.id);a!==-1&&(h.value[a]={...h.value[a],code:o.code,title:o.title,author:o.author,category:_.value.find(v=>v.id===o.categoryId),description:o.description})}else{const a=await ce({code:o.code,title:o.title,author:o.author,categoryId:o.categoryId,description:o.description});h.value.push({...a,category:_.value.find(v=>v.id===o.categoryId)}),m("图书添加成功")}D()}catch(a){m((c.value?"更新":"添加")+"失败: "+(((t=(l=a.response)==null?void 0:l.data)==null?void 0:t.message)||"未知错误"),"error"),console.error(c.value?"Failed to update book:":"Failed to add book:",a)}finally{g.value=!1}},ee=async()=>{var l,t;if(f.value)try{w.value=!0,await ne(f.value.id),h.value=h.value.filter(a=>a.id!==f.value.id),m("图书删除成功"),M()}catch(a){m("删除失败: "+(((t=(l=a.response)==null?void 0:l.data)==null?void 0:t.message)||"未知错误"),"error"),console.error("Failed to delete book:",a)}finally{w.value=!1}},E=()=>{},T=()=>{o.code="",o.title="",o.author="",o.categoryId="",o.description=""},H=()=>{r.code="",r.title="",r.author="",r.categoryId=""},m=(l,t="success")=>{B.value=l,U.value=t,setTimeout(()=>{B.value=""},3e3)};return le(()=>{K()}),(l,t)=>{var a,v,N,q,A,$,z;return i(),d("div",ve,[t[22]||(t[22]=e("div",{class:"page-header"},[e("h1",null,"图书管理"),e("p",{class:"subtitle"},"管理图书信息，包括添加、编辑和删除操作")],-1)),e("div",{class:"action-bar"},[e("button",{class:"add-button",onClick:R},[...t[7]||(t[7]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),ae(" 添加图书 ",-1)])])]),e("div",pe,[k(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),placeholder:"搜索图书名称、作者或编码",class:"search-input",onInput:E},null,544),[[C,b.value]]),k(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),class:"category-select",onChange:E},[t[8]||(t[8]=e("option",{value:""},"全部分类",-1)),(i(!0),d(F,null,j(_.value,s=>(i(),d("option",{key:s.id,value:s.id},n(s.name),9,ge))),128))],544),[[Z,x.value]])]),e("div",he,[V.value?(i(),d("div",ye,[...t[9]||(t[9]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"加载中...",-1)])])):h.value.length===0?(i(),d("div",ke,[...t[10]||(t[10]=[de('<div class="empty-icon" data-v-1d499532><svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-1d499532><path d="M4 19.5C4 18.837 4.26339 18.2011 4.73223 17.7322C5.20107 17.2634 5.83696 17 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-1d499532></path><path d="M6.5 2H20V22H6.5C5.83696 22 5.20107 21.7366 4.73223 21.2678C4.26339 20.7989 4 20.163 4 19.5V4.5C4 3.83696 4.26339 3.20107 4.73223 2.73223C5.20107 2.26339 5.83696 2 6.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-1d499532></path></svg></div><div class="empty-text" data-v-1d499532><h3 data-v-1d499532>暂无图书数据</h3><p data-v-1d499532>点击&quot;添加图书&quot;按钮开始添加图书信息</p></div>',2)])])):(i(),d("div",be,[e("table",fe,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"图书编码"),e("th",null,"图书名称"),e("th",null,"作者"),e("th",null,"分类"),e("th",null,"状态"),e("th",null,"操作")])],-1)),e("tbody",null,[(i(!0),d(F,null,j(J.value,s=>{var P;return i(),d("tr",{key:s.id},[e("td",me,n(s.code),1),e("td",_e,n(s.title),1),e("td",we,n(s.author),1),e("td",Ce,n(((P=s.category)==null?void 0:P.name)||"未分类"),1),e("td",xe,[e("span",{class:G(["status-badge",s.status])},n(s.status==="available"?"可借阅":"已借出"),3)]),e("td",Ie,[e("button",{class:"edit-button",onClick:te=>W(s)},"编辑",8,Be),e("button",{class:"delete-button",onClick:te=>X(s),disabled:s.status==="borrowed"},"删除",8,De)])])}),128))])])]))]),I.value?(i(),d("div",{key:0,class:"dialog-overlay",onClick:S(D,["self"])},[e("div",Me,[e("div",Ve,[e("h3",null,n(c.value?"编辑图书":"添加图书"),1),e("button",{class:"close-button",onClick:D},[...t[12]||(t[12]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("div",Le,[e("form",{onSubmit:S(Y,["prevent"])},[e("div",Fe,[t[13]||(t[13]=e("label",{for:"book-code"},"图书编码 *",-1)),k(e("input",{type:"text",id:"book-code","onUpdate:modelValue":t[2]||(t[2]=s=>o.code=s),placeholder:"请输入图书编码",disabled:g.value||c.value&&((a=p.value)==null?void 0:a.status)==="borrowed"},null,8,je),[[C,o.code]]),r.code?(i(),d("span",Se,n(r.code),1)):y("",!0)]),e("div",Ue,[t[14]||(t[14]=e("label",{for:"book-title"},"图书名称 *",-1)),k(e("input",{type:"text",id:"book-title","onUpdate:modelValue":t[3]||(t[3]=s=>o.title=s),placeholder:"请输入图书名称",disabled:g.value||c.value&&((v=p.value)==null?void 0:v.status)==="borrowed"},null,8,Ee),[[C,o.title]]),r.title?(i(),d("span",Te,n(r.title),1)):y("",!0)]),e("div",He,[t[15]||(t[15]=e("label",{for:"book-author"},"作者 *",-1)),k(e("input",{type:"text",id:"book-author","onUpdate:modelValue":t[4]||(t[4]=s=>o.author=s),placeholder:"请输入作者姓名",disabled:g.value||c.value&&((N=p.value)==null?void 0:N.status)==="borrowed"},null,8,Ne),[[C,o.author]]),r.author?(i(),d("span",qe,n(r.author),1)):y("",!0)]),e("div",Ae,[t[17]||(t[17]=e("label",{for:"book-category"},"分类 *",-1)),k(e("select",{id:"book-category","onUpdate:modelValue":t[5]||(t[5]=s=>o.categoryId=s),disabled:g.value||c.value&&((q=p.value)==null?void 0:q.status)==="borrowed"},[t[16]||(t[16]=e("option",{value:"",disabled:""},"请选择分类",-1)),(i(!0),d(F,null,j(_.value,s=>(i(),d("option",{key:s.id,value:s.id},n(s.name),9,ze))),128))],8,$e),[[Z,o.categoryId]]),r.categoryId?(i(),d("span",Pe,n(r.categoryId),1)):y("",!0)]),e("div",Qe,[t[18]||(t[18]=e("label",{for:"book-description"},"描述（可选）",-1)),k(e("textarea",{id:"book-description","onUpdate:modelValue":t[6]||(t[6]=s=>o.description=s),placeholder:"请输入图书描述",rows:"3",disabled:g.value||c.value&&((A=p.value)==null?void 0:A.status)==="borrowed"},null,8,Ze),[[C,o.description]])]),e("div",Ge,[e("button",{type:"button",class:"dialog-button secondary",onClick:D,disabled:g.value},"取消",8,Je),e("button",{type:"submit",class:"dialog-button primary",disabled:g.value||c.value&&(($=p.value)==null?void 0:$.status)==="borrowed"},[g.value?(i(),d("span",Oe,"处理中...")):(i(),d("span",Re,n(c.value?"保存修改":"添加图书"),1))],8,Ke)])],32)])])])):y("",!0),L.value?(i(),d("div",{key:1,class:"dialog-overlay",onClick:S(M,["self"])},[e("div",We,[e("div",{class:"dialog-header"},[t[20]||(t[20]=e("h3",null,"确认删除",-1)),e("button",{class:"close-button",onClick:M},[...t[19]||(t[19]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("div",Xe,[e("p",Ye,"您确定要删除图书《"+n((z=f.value)==null?void 0:z.title)+"》吗？",1),t[21]||(t[21]=e("p",{class:"delete-hint"},"此操作无法撤销，删除后数据将无法恢复。",-1))]),e("div",et,[e("button",{class:"dialog-button secondary",onClick:M,disabled:w.value},"取消",8,tt),e("button",{class:"dialog-button danger",onClick:ee,disabled:w.value},[w.value?(i(),d("span",st,"处理中...")):(i(),d("span",lt,"确认删除"))],8,ot)])])])):y("",!0),B.value?(i(),d("div",{key:2,class:G(["message-toast",U.value])},n(B.value),3)):y("",!0)])}}},nt=oe(at,[["__scopeId","data-v-1d499532"]]);export{nt as default};
