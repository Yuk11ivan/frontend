import{_ as e,r as a,q as o,s as l,x as s,c as t,a as r,d as i,w as u,j as n,v as d,b as v,t as c,g as p,h as k,i as b,n as h,p as m,o as w,l as y}from"./index-LEf4sZUU.js";import{c as g,b as f}from"./api-CtTze4QI.js";const C={class:"borrow-container"},x={class:"borrow-form-card"},j={class:"form-group"},_=["disabled"],B={key:0,class:"code-checking"},V={key:1,class:"book-info-preview"},M={class:"book-preview-content"},H={class:"book-details-preview"},I={class:"book-title-preview"},q={class:"book-author-preview"},L={key:0,class:"book-unavailable"},U={key:2,class:"error-message"},F={class:"form-group"},S=["disabled"],T={key:0,class:"error-message"},Z={class:"form-actions"},$=["disabled"],z={key:0},A={key:1},D={key:0,class:"success-message"},E={class:"success-actions"},G=e({__name:"BorrowBook",setup(e){const G=a(""),J=a(""),K=a(null),N=a(!1),O=a(!1),P=a(!1),Q=o({bookCode:"",phone:""}),R=a(""),W=a("success"),X=l(()=>""!==G.value.trim()&&""!==J.value.trim()&&!Q.bookCode&&!Q.phone&&null!==K.value),Y=()=>{G.value.trim()?Q.bookCode="":(Q.bookCode="请输入图书编码",K.value=null)},ee=async()=>{if(G.value.trim())try{N.value=!0,Q.bookCode="";const e=await g(G.value);K.value=e,e.available||(Q.bookCode="该图书当前不可借阅")}catch(e){Q.bookCode="未找到该图书",K.value=null}finally{N.value=!1}},ae=()=>{J.value?/^1[3-9]\d{9}$/.test(J.value)?Q.phone="":Q.phone="请输入有效的11位手机号":Q.phone="请输入手机号"},oe=async()=>{var e,a;if(Y(),ae(),X.value)try{O.value=!0,await f(K.value.id,J.value),P.value=!0,le("借阅成功","success")}catch(o){le("借阅失败: "+((null==(a=null==(e=o.response)?void 0:e.data)?void 0:a.message)||"未知错误"),"error"),console.error("Failed to borrow book:",o)}finally{O.value=!1}},le=(e,a="success")=>{R.value=e,W.value=a,setTimeout(()=>{R.value=""},3e3)},se=m();return s(()=>se.query.code,e=>{e&&!G.value&&(G.value=e,Y(),ee())},{immediate:!0}),(e,a)=>{const o=b("router-link");return w(),t("div",C,[a[10]||(a[10]=r("div",{class:"page-header"},[r("h1",null,"借阅图书"),r("p",{class:"subtitle"},"请输入图书编码和您的联系信息完成借阅")],-1)),r("div",x,[r("form",{onSubmit:u(oe,["prevent"])},[r("div",j,[a[3]||(a[3]=r("label",{for:"book-code"},"图书编码",-1)),n(r("input",{type:"text",id:"book-code","onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),placeholder:"请输入图书编码",disabled:N.value||O.value,onInput:Y,onBlur:ee},null,40,_),[[d,G.value]]),N.value?(w(),t("div",B," 验证中... ")):K.value?(w(),t("div",V,[r("div",M,[a[2]||(a[2]=v('<div class="book-icon-small" data-v-e33549e2><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-e33549e2><path d="M9 7H39C40.6569 7 42 8.34315 42 10V38C42 39.6569 40.6569 41 39 41H9C7.34315 41 6 39.6569 6 38V10C6 8.34315 7.34315 7 9 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-e33549e2></path><path d="M36 7V41" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-e33549e2></path><path d="M12 15H36" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-e33549e2></path></svg></div>',1)),r("div",H,[r("p",I,c(K.value.title),1),r("p",q,"作者: "+c(K.value.author),1)]),K.value.available?i("",!0):(w(),t("div",L," 不可借阅 "))])])):i("",!0),Q.bookCode?(w(),t("span",U,c(Q.bookCode),1)):i("",!0)]),r("div",F,[a[4]||(a[4]=r("label",{for:"phone"},"手机号",-1)),n(r("input",{type:"tel",id:"phone","onUpdate:modelValue":a[1]||(a[1]=e=>J.value=e),placeholder:"请输入您的手机号",maxlength:"11",disabled:O.value,onInput:ae},null,40,S),[[d,J.value]]),Q.phone?(w(),t("span",T,c(Q.phone),1)):i("",!0)]),r("div",Z,[p(o,{to:"/",class:"action-button secondary"},{default:k(()=>[...a[5]||(a[5]=[y(" 返回图书列表 ",-1)])]),_:1}),r("button",{type:"submit",class:"action-button primary",disabled:!X.value||O.value||K.value&&!K.value.available},[O.value?(w(),t("span",z,"处理中...")):(w(),t("span",A,"确认借阅"))],8,$)])],32)]),P.value?(w(),t("div",D,[a[7]||(a[7]=r("div",{class:"success-icon"},[r("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),a[8]||(a[8]=r("h3",null,"借阅成功！",-1)),r("p",null,"您已成功借阅《"+c(K.value.title)+"》",1),a[9]||(a[9]=r("p",{class:"reminder"},"请记得按时归还图书。",-1)),r("div",E,[p(o,{to:"/",class:"action-button primary"},{default:k(()=>[...a[6]||(a[6]=[y(" 返回图书列表 ",-1)])]),_:1})])])):i("",!0),R.value?(w(),t("div",{key:1,class:h(["message-toast",W.value])},c(R.value),3)):i("",!0)])}}},[["__scopeId","data-v-e33549e2"]]);export{G as default};
