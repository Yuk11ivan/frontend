import{_ as e,r as l,q as a,s as t,c as o,a as s,d as n,j as r,v as u,k as i,t as d,l as c,F as v,f as h,w as k,n as p,o as g}from"./index-b4DvcIw6.js";import{d as w,r as b}from"./api-CX5TFECn.js";const y={class:"return-container"},C={key:0,class:"search-card"},m={class:"search-form"},f={class:"form-group"},x=["disabled"],D={key:0,class:"error-message"},j=["disabled"],M={key:0},L={key:1},V={key:1,class:"records-section"},B={class:"records-header"},H={key:0,class:"loading-container"},_={key:1,class:"no-records"},I={key:2,class:"records-container"},F={class:"records-table-wrapper"},S={class:"records-table"},q={class:"book-title"},z=["disabled","onClick"],K={key:0},N={key:1},O={key:1,class:"returned-text"},R={class:"records-summary"},T={class:"dialog-content"},U={class:"dialog-body"},Z={class:"dialog-footer"},$=["disabled"],A={class:"dialog-content success-dialog"},E=e({__name:"ReturnBook",setup(e){const E=l(""),G=a({phone:""}),J=l(!1),P=l(!1),Q=l([]),W=l(!1),X=l(!1),Y=l(!1),ee=l(null),le=l(null),ae=l(""),te=l(""),oe=l("success"),se=t(()=>Q.value.filter(e=>!e.returnDate).length),ne=t(()=>Q.value.filter(e=>!!e.returnDate).length),re=()=>{E.value?/^1[3-9]\d{9}$/.test(E.value)?G.phone="":G.phone="请输入有效的11位手机号":G.phone="请输入手机号"},ue=async()=>{var e,l;if(re(),!G.phone&&E.value)try{J.value=!0;const e=await w(E.value);Q.value=e,P.value=!0}catch(a){pe("查询失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"未知错误"),"error"),console.error("Failed to search records:",a)}finally{J.value=!1}},ie=()=>{P.value=!1,Q.value=[],E.value="",G.phone=""},de=()=>{X.value=!1,ee.value=null},ce=async()=>{var e,l;if(ee.value)try{le.value=ee.value.id,await b(ee.value.id),ae.value=ee.value.book.title,X.value=!1,Y.value=!0;const e=Q.value.findIndex(e=>e.id===ee.value.id);-1!==e&&(Q.value[e].returnDate=(new Date).toISOString()),ee.value=null}catch(a){pe("归还失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"未知错误"),"error"),console.error("Failed to return book:",a)}finally{le.value=null}},ve=()=>{Y.value=!1,ae.value=""},he=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},ke=e=>{if(!e)return"";const l=new Date(e),a=new Date(l);return a.setDate(a.getDate()+30),a},pe=(e,l="success")=>{te.value=e,oe.value=l,setTimeout(()=>{te.value=""},3e3)};return(e,l)=>{var a,t;return g(),o("div",y,[l[11]||(l[11]=s("div",{class:"page-header"},[s("h1",null,"归还图书"),s("p",{class:"subtitle"},"请输入借阅时的手机号，查看并归还您的借阅图书")],-1)),P.value?(g(),o("div",V,[s("div",B,[s("h2",null,"借阅记录 - "+d(E.value),1),s("button",{class:"back-button",onClick:ie},[...l[3]||(l[3]=[s("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M19 12H5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),c(" 返回重新查询 ",-1)])])]),W.value?(g(),o("div",H,[...l[4]||(l[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"加载中...",-1)])])):0===Q.value.length?(g(),o("div",_,[...l[5]||(l[5]=[s("div",{class:"no-records-icon"},[s("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M9 17H5C3.89543 17 3 16.1046 3 15V4C3 2.89543 3.89543 2 5 2H14C15.1046 2 16 2.89543 16 4V15C16 16.1046 15.1046 17 14 17H10M16 17V19C16 20.1046 15.1046 21 14 21H10C8.89543 21 8 20.1046 8 19V17M9 17V13C9 11.8954 9.89543 11 11 11H13C14.1046 11 15 11.8954 15 13V17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),s("div",{class:"no-records-content"},[s("h3",null,"暂无借阅记录"),s("p",null,"未找到该手机号的借阅记录或所有图书已归还")],-1)])])):(g(),o("div",I,[s("div",F,[s("table",S,[l[6]||(l[6]=s("thead",null,[s("tr",null,[s("th",null,"图书编码"),s("th",null,"图书名称"),s("th",null,"借阅时间"),s("th",null,"预计归还时间"),s("th",null,"状态"),s("th",null,"操作")])],-1)),s("tbody",null,[(g(!0),o(v,null,h(Q.value,e=>(g(),o("tr",{key:e.id},[s("td",null,d(e.book.code),1),s("td",q,d(e.book.title),1),s("td",null,d(he(e.borrowDate)),1),s("td",null,d(he(ke(e.borrowDate))),1),s("td",{class:p("status-"+(e.returnDate?"returned":"borrowed"))},d(e.returnDate?"已归还":"借阅中"),3),s("td",null,[e.returnDate?(g(),o("span",O,"已归还")):(g(),o("button",{key:0,class:"return-button",disabled:le.value===e.id,onClick:l=>(e=>{ee.value=e,X.value=!0})(e)},[le.value===e.id?(g(),o("span",K,"处理中...")):(g(),o("span",N,"归还图书"))],8,z))])]))),128))])])]),s("div",R," 共 "+d(Q.value.length)+" 条记录，其中 "+d(se.value)+" 条借阅中，"+d(ne.value)+" 条已归还 ",1)]))])):(g(),o("div",C,[s("div",m,[s("div",f,[l[1]||(l[1]=s("label",{for:"phone"},"手机号",-1)),r(s("input",{type:"tel",id:"phone","onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),placeholder:"请输入借阅时的手机号",maxlength:"11",disabled:J.value,onInput:re,onKeyup:i(ue,["enter"])},null,40,x),[[u,E.value]]),G.phone?(g(),o("span",D,d(G.phone),1)):n("",!0)]),s("button",{class:"search-button",disabled:!E.value||G.phone||J.value,onClick:ue},[J.value?(g(),o("span",M,"搜索中...")):(g(),o("span",L,[...l[2]||(l[2]=[s("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M21 21L16.65 16.65M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),c(" 查询借阅记录 ",-1)])]))],8,j)])])),X.value?(g(),o("div",{key:2,class:"dialog-overlay",onClick:k(de,["self"])},[s("div",T,[s("div",{class:"dialog-header"},[l[8]||(l[8]=s("h3",null,"确认归还图书",-1)),s("button",{class:"close-button",onClick:de},[...l[7]||(l[7]=[s("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),s("div",U,[s("p",null,"您确定要归还图书《"+d(null==(t=null==(a=ee.value)?void 0:a.book)?void 0:t.title)+"》吗？",1)]),s("div",Z,[s("button",{class:"dialog-button secondary",onClick:de},"取消"),s("button",{class:"dialog-button primary",onClick:ce,disabled:le.value},"确认归还",8,$)])])])):n("",!0),Y.value?(g(),o("div",{key:3,class:"dialog-overlay",onClick:k(ve,["self"])},[s("div",A,[l[9]||(l[9]=s("div",{class:"success-icon-large"},[s("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),l[10]||(l[10]=s("h3",null,"归还成功！",-1)),s("p",null,"感谢您及时归还图书《"+d(ae.value)+"》",1),s("button",{class:"dialog-button primary large",onClick:ve},"确定")])])):n("",!0),te.value?(g(),o("div",{key:4,class:p(["message-toast",oe.value])},d(te.value),3)):n("",!0)])}}},[["__scopeId","data-v-9acea08f"]]);export{E as default};
