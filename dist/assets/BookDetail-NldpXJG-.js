import{_ as H,p as L,r as d,e as N,c as s,a as t,d as c,l as F,b as R,t as r,n as _,F as T,f as I,w as P,j as z,v as E,u as S,o as a}from"./index-BPoYUc4d.js";import{g as U,a as Z,b as $}from"./api-DS5VUnfc.js";const q={class:"book-detail-container"},A={key:0,class:"loading-container"},G={key:1,class:"book-detail-content"},J={class:"detail-main"},K={class:"book-cover-large"},O={key:0,class:"status-badge-large"},Q={class:"book-info-detail"},W={class:"book-title-detail"},X={class:"book-author-detail"},Y={class:"book-meta"},tt={class:"meta-item"},ot={class:"meta-value"},et={class:"meta-item"},st={class:"meta-value"},at={class:"meta-item"},lt={key:0,class:"meta-item description"},rt={class:"meta-value"},nt={class:"action-section"},it={key:1,class:"action-button disabled large",disabled:""},dt={key:0,class:"borrow-records-section"},ut={class:"records-table-container"},ct={class:"records-table"},vt={key:2,class:"error-container"},kt={class:"dialog-content"},ht={class:"dialog-body"},pt={class:"form-group"},bt={key:0,class:"error-message"},mt={class:"dialog-footer"},gt=["disabled"],wt={__name:"BookDetail",setup(_t){const B=L(),D=S(),b=B.params.id,l=d(null),k=d([]),m=d(!0),g=d(!1),u=d(""),i=d(""),h=d(""),y=d("success"),f=async()=>{try{m.value=!0;const[e,o]=await Promise.all([U(b),Z(b)]);l.value=e,k.value=o}catch(e){w("加载图书详情失败","error"),console.error("Failed to load book detail:",e)}finally{m.value=!1}},M=e=>e?/^1[3-9]\d{9}$/.test(e)?(i.value="",!0):(i.value="请输入有效的11位手机号",!1):(i.value="请输入手机号",!1),x=()=>{g.value=!0,u.value="",i.value=""},p=()=>{g.value=!1,u.value="",i.value=""},j=async()=>{var e,o;if(M(u.value))try{await $(b,u.value),w("借阅成功"),p(),await f()}catch(v){w("借阅失败: "+(((o=(e=v.response)==null?void 0:e.data)==null?void 0:o.message)||"未知错误"),"error"),console.error("Failed to borrow book:",v)}},C=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",w=(e,o="success")=>{h.value=e,y.value=o,setTimeout(()=>{h.value=""},3e3)},V=()=>{D.back()};return N(()=>{f()}),(e,o)=>{var v;return a(),s("div",q,[t("div",{class:"detail-header"},[t("button",{class:"back-button",onClick:V},[...o[1]||(o[1]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M19 12H5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),F(" 返回列表 ",-1)])])]),m.value?(a(),s("div",A,[...o[2]||(o[2]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"加载中...",-1)])])):l.value?(a(),s("div",G,[t("div",J,[t("div",K,[o[3]||(o[3]=R('<div class="book-icon-large" data-v-d133d568><svg width="120" height="120" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d133d568><path d="M9 7H39C40.6569 7 42 8.34315 42 10V38C42 39.6569 40.6569 41 39 41H9C7.34315 41 6 39.6569 6 38V10C6 8.34315 7.34315 7 9 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d133d568></path><path d="M36 7V41" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d133d568></path><path d="M12 15H36" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-d133d568></path><path d="M12 21H36" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-d133d568></path><path d="M12 27H30" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-d133d568></path><path d="M12 33H24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-d133d568></path></svg></div>',1)),l.value.status==="borrowed"?(a(),s("div",O,"已借出")):c("",!0)]),t("div",Q,[t("h1",W,r(l.value.title),1),t("p",X,"作者: "+r(l.value.author),1),t("div",Y,[t("div",tt,[o[4]||(o[4]=t("span",{class:"meta-label"},"分类:",-1)),t("span",ot,r(((v=l.value.category)==null?void 0:v.name)||"未分类"),1)]),t("div",et,[o[5]||(o[5]=t("span",{class:"meta-label"},"图书编码:",-1)),t("span",st,r(l.value.code),1)]),t("div",at,[o[6]||(o[6]=t("span",{class:"meta-label"},"状态:",-1)),t("span",{class:_(["meta-value","status-"+l.value.status])},r(l.value.status==="available"?"可借阅":"已借出"),3)]),l.value.description?(a(),s("div",lt,[o[7]||(o[7]=t("span",{class:"meta-label"},"描述:",-1)),t("span",rt,r(l.value.description),1)])):c("",!0)]),t("div",nt,[l.value.status==="available"?(a(),s("button",{key:0,class:"action-button primary large",onClick:x}," 立即借阅 ")):(a(),s("button",it," 已被借出 "))])])]),k.value&&k.value.length>0?(a(),s("div",dt,[o[9]||(o[9]=t("h2",null,"借阅记录",-1)),t("div",ut,[t("table",ct,[o[8]||(o[8]=t("thead",null,[t("tr",null,[t("th",null,"借阅人手机号"),t("th",null,"借阅时间"),t("th",null,"归还时间"),t("th",null,"状态")])],-1)),t("tbody",null,[(a(!0),s(T,null,I(k.value,n=>(a(),s("tr",{key:n.id},[t("td",null,r(n.phone),1),t("td",null,r(C(n.borrowDate)),1),t("td",null,r(n.returnDate?C(n.returnDate):"-"),1),t("td",{class:_("status-"+(n.returnDate?"returned":"active"))},r(n.returnDate?"已归还":"借阅中"),3)]))),128))])])])])):c("",!0)])):(a(),s("div",vt,[...o[10]||(o[10]=[t("p",null,"未找到该图书信息",-1)])])),g.value?(a(),s("div",{key:3,class:"dialog-overlay",onClick:P(p,["self"])},[t("div",kt,[t("div",{class:"dialog-header"},[o[12]||(o[12]=t("h3",null,"借阅图书",-1)),t("button",{class:"close-button",onClick:p},[...o[11]||(o[11]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),t("div",ht,[t("div",pt,[o[13]||(o[13]=t("label",{for:"phone"},"手机号",-1)),z(t("input",{type:"tel",id:"phone","onUpdate:modelValue":o[0]||(o[0]=n=>u.value=n),placeholder:"请输入您的手机号",maxlength:"11"},null,512),[[E,u.value]]),i.value?(a(),s("span",bt,r(i.value),1)):c("",!0)])]),t("div",mt,[t("button",{class:"action-button secondary",onClick:p},"取消"),t("button",{class:"action-button primary",onClick:j,disabled:!u.value||i.value},"确认借阅",8,gt)])])])):c("",!0),h.value?(a(),s("div",{key:4,class:_(["message-toast",y.value])},r(h.value),3)):c("",!0)])}}},Ct=H(wt,[["__scopeId","data-v-d133d568"]]);export{Ct as default};
