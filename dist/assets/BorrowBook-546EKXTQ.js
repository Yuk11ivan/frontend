import{_ as I,r as i,q as T,s as H,x as q,c as l,a as o,d as c,w as D,j as B,v as x,b as F,t as v,g as V,h as M,i as L,n as U,p as z,o as r,l as S}from"./index-Bw86Jh8l.js";import{c as E,b as P}from"./api-DS5VUnfc.js";const R={class:"borrow-container"},Z={class:"borrow-form-card"},$={class:"form-group"},A=["disabled"],G={key:0,class:"code-checking"},J={key:1,class:"book-info-preview"},K={class:"book-preview-content"},O={class:"book-details-preview"},Q={class:"book-title-preview"},W={class:"book-author-preview"},X={key:0,class:"book-unavailable"},Y={key:2,class:"error-message"},ee={class:"form-group"},oe=["disabled"],se={key:0,class:"error-message"},te={class:"form-actions"},ae=["disabled"],le={key:0},re={key:1},ne={key:0,class:"success-message"},ie={class:"success-actions"},de={__name:"BorrowBook",setup(ue){const n=i(""),d=i(""),t=i(null),k=i(!1),u=i(!1),_=i(!1),s=T({bookCode:"",phone:""}),b=i(""),w=i("success"),f=H(()=>n.value.trim()!==""&&d.value.trim()!==""&&!s.bookCode&&!s.phone&&t.value!==null),h=()=>{n.value.trim()?s.bookCode="":(s.bookCode="请输入图书编码",t.value=null)},g=async()=>{if(n.value.trim())try{k.value=!0,s.bookCode="";const a=await E(n.value);t.value=a,a.available||(s.bookCode="该图书当前不可借阅")}catch{s.bookCode="未找到该图书",t.value=null}finally{k.value=!1}},y=()=>{d.value?/^1[3-9]\d{9}$/.test(d.value)?s.phone="":s.phone="请输入有效的11位手机号":s.phone="请输入手机号"},j=async()=>{var a,e;if(h(),y(),!!f.value)try{u.value=!0,await P(t.value.id,d.value),_.value=!0,C("借阅成功","success")}catch(p){C("借阅失败: "+(((e=(a=p.response)==null?void 0:a.data)==null?void 0:e.message)||"未知错误"),"error"),console.error("Failed to borrow book:",p)}finally{u.value=!1}},C=(a,e="success")=>{b.value=a,w.value=e,setTimeout(()=>{b.value=""},3e3)},N=z();return q(()=>N.query.code,a=>{a&&!n.value&&(n.value=a,h(),g())},{immediate:!0}),(a,e)=>{const p=L("router-link");return r(),l("div",R,[e[10]||(e[10]=o("div",{class:"page-header"},[o("h1",null,"借阅图书"),o("p",{class:"subtitle"},"请输入图书编码和您的联系信息完成借阅")],-1)),o("div",Z,[o("form",{onSubmit:D(j,["prevent"])},[o("div",$,[e[3]||(e[3]=o("label",{for:"book-code"},"图书编码",-1)),B(o("input",{type:"text",id:"book-code","onUpdate:modelValue":e[0]||(e[0]=m=>n.value=m),placeholder:"请输入图书编码",disabled:k.value||u.value,onInput:h,onBlur:g},null,40,A),[[x,n.value]]),k.value?(r(),l("div",G," 验证中... ")):t.value?(r(),l("div",J,[o("div",K,[e[2]||(e[2]=F('<div class="book-icon-small" data-v-e33549e2><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-e33549e2><path d="M9 7H39C40.6569 7 42 8.34315 42 10V38C42 39.6569 40.6569 41 39 41H9C7.34315 41 6 39.6569 6 38V10C6 8.34315 7.34315 7 9 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-e33549e2></path><path d="M36 7V41" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-e33549e2></path><path d="M12 15H36" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-e33549e2></path></svg></div>',1)),o("div",O,[o("p",Q,v(t.value.title),1),o("p",W,"作者: "+v(t.value.author),1)]),t.value.available?c("",!0):(r(),l("div",X," 不可借阅 "))])])):c("",!0),s.bookCode?(r(),l("span",Y,v(s.bookCode),1)):c("",!0)]),o("div",ee,[e[4]||(e[4]=o("label",{for:"phone"},"手机号",-1)),B(o("input",{type:"tel",id:"phone","onUpdate:modelValue":e[1]||(e[1]=m=>d.value=m),placeholder:"请输入您的手机号",maxlength:"11",disabled:u.value,onInput:y},null,40,oe),[[x,d.value]]),s.phone?(r(),l("span",se,v(s.phone),1)):c("",!0)]),o("div",te,[V(p,{to:"/",class:"action-button secondary"},{default:M(()=>[...e[5]||(e[5]=[S(" 返回图书列表 ",-1)])]),_:1}),o("button",{type:"submit",class:"action-button primary",disabled:!f.value||u.value||t.value&&!t.value.available},[u.value?(r(),l("span",le,"处理中...")):(r(),l("span",re,"确认借阅"))],8,ae)])],32)]),_.value?(r(),l("div",ne,[e[7]||(e[7]=o("div",{class:"success-icon"},[o("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[8]||(e[8]=o("h3",null,"借阅成功！",-1)),o("p",null,"您已成功借阅《"+v(t.value.title)+"》",1),e[9]||(e[9]=o("p",{class:"reminder"},"请记得按时归还图书。",-1)),o("div",ie,[V(p,{to:"/",class:"action-button primary"},{default:M(()=>[...e[6]||(e[6]=[S(" 返回图书列表 ",-1)])]),_:1})])])):c("",!0),b.value?(r(),l("div",{key:1,class:U(["message-toast",w.value])},v(b.value),3)):c("",!0)])}}},pe=I(de,[["__scopeId","data-v-e33549e2"]]);export{pe as default};
