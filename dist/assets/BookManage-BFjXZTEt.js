import{_ as e,r as a,q as l,s as o,e as t,c as s,a as d,d as i,l as r,j as u,v as n,y as c,F as v,f as p,b as h,w as g,t as b,n as k,o as y}from"./index-b4DvcIw6.js";import{e as w,f as m,h as f,u as C,i as I}from"./api-CX5TFECn.js";const x={class:"manage-container"},j={class:"search-bar"},L=["value"],V={class:"books-content"},M={key:0,class:"loading-container"},U={key:1,class:"empty-state"},B={key:2,class:"books-table-wrapper"},F={class:"books-table"},_={class:"code-cell"},H={class:"title-cell"},q={class:"author-cell"},S={class:"category-cell"},P={class:"status-cell"},T={class:"action-cell"},Z=["onClick"],z=["onClick","disabled"],A={class:"dialog-content"},D={class:"dialog-header"},E={class:"dialog-body"},G={class:"form-group"},J=["disabled"],K={key:0,class:"error-message"},N={class:"form-group"},O=["disabled"],Q={key:0,class:"error-message"},R={class:"form-group"},W=["disabled"],X={key:0,class:"error-message"},Y={class:"form-group"},$=["disabled"],ee=["value"],ae={key:0,class:"error-message"},le={class:"form-group"},oe=["disabled"],te={class:"dialog-footer"},se=["disabled"],de=["disabled"],ie={key:0},re={key:1},ue={class:"dialog-content delete-dialog"},ne={class:"dialog-body"},ce={class:"warning-text"},ve={class:"dialog-footer"},pe=["disabled"],he=["disabled"],ge={key:0},be={key:1},ke=e({__name:"BookManage",setup(e){const ke=a([]),ye=a([]),we=a(!1),me=a(""),fe=a(""),Ce=a(!1),Ie=a(!1),xe=a(!1),je=a(null),Le=a(null),Ve=a(!1),Me=a(!1),Ue=a(""),Be=a("success"),Fe=l({code:"",title:"",author:"",categoryId:"",description:""}),_e=l({code:"",title:"",author:"",categoryId:""}),He=o(()=>ke.value.filter(e=>{var a;const l=!me.value||e.title.toLowerCase().includes(me.value.toLowerCase())||e.author.toLowerCase().includes(me.value.toLowerCase())||e.code.toLowerCase().includes(me.value.toLowerCase()),o=!fe.value||(null==(a=e.category)?void 0:a.id.toString())===fe.value;return l&&o})),qe=()=>{xe.value=!1,je.value=null,Ae(),Ce.value=!0},Se=()=>{Ce.value=!1,Ae(),De()},Pe=()=>{Ie.value=!1,Le.value=null},Te=async()=>{var e,a;if((()=>{let e=!0;return _e.code="",_e.title="",_e.author="",_e.categoryId="",Fe.code.trim()||(_e.code="请输入图书编码",e=!1),Fe.title.trim()||(_e.title="请输入图书名称",e=!1),Fe.author.trim()||(_e.author="请输入作者姓名",e=!1),Fe.categoryId||(_e.categoryId="请选择分类",e=!1),e})())try{if(Ve.value=!0,xe.value&&je.value){await C(je.value.id,{code:Fe.code,title:Fe.title,author:Fe.author,categoryId:Fe.categoryId,description:Fe.description}),Ee("图书信息更新成功");const e=ke.value.findIndex(e=>e.id===je.value.id);-1!==e&&(ke.value[e]={...ke.value[e],code:Fe.code,title:Fe.title,author:Fe.author,category:ye.value.find(e=>e.id===Fe.categoryId),description:Fe.description})}else{const e=await I({code:Fe.code,title:Fe.title,author:Fe.author,categoryId:Fe.categoryId,description:Fe.description});ke.value.push({...e,category:ye.value.find(e=>e.id===Fe.categoryId)}),Ee("图书添加成功")}Se()}catch(l){Ee((xe.value?"更新":"添加")+"失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"未知错误"),"error"),console.error(xe.value?"Failed to update book:":"Failed to add book:",l)}finally{Ve.value=!1}},Ze=async()=>{var e,a;if(Le.value)try{Me.value=!0,await f(Le.value.id),ke.value=ke.value.filter(e=>e.id!==Le.value.id),Ee("图书删除成功"),Pe()}catch(l){Ee("删除失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"未知错误"),"error"),console.error("Failed to delete book:",l)}finally{Me.value=!1}},ze=()=>{},Ae=()=>{Fe.code="",Fe.title="",Fe.author="",Fe.categoryId="",Fe.description=""},De=()=>{_e.code="",_e.title="",_e.author="",_e.categoryId=""},Ee=(e,a="success")=>{Ue.value=e,Be.value=a,setTimeout(()=>{Ue.value=""},3e3)};return t(()=>{(async()=>{var e,a;try{we.value=!0;const[e,a]=await Promise.all([w(),m()]);ke.value=e,ye.value=a}catch(l){Ee("加载数据失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"未知错误"),"error"),console.error("Failed to load data:",l)}finally{we.value=!1}})()}),(e,a)=>{var l,o,t,w,m,f,C;return y(),s("div",x,[a[22]||(a[22]=d("div",{class:"page-header"},[d("h1",null,"图书管理"),d("p",{class:"subtitle"},"管理图书信息，包括添加、编辑和删除操作")],-1)),d("div",{class:"action-bar"},[d("button",{class:"add-button",onClick:qe},[...a[7]||(a[7]=[d("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),r(" 添加图书 ",-1)])])]),d("div",j,[u(d("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>me.value=e),placeholder:"搜索图书名称、作者或编码",class:"search-input",onInput:ze},null,544),[[n,me.value]]),u(d("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>fe.value=e),class:"category-select",onChange:ze},[a[8]||(a[8]=d("option",{value:""},"全部分类",-1)),(y(!0),s(v,null,p(ye.value,e=>(y(),s("option",{key:e.id,value:e.id},b(e.name),9,L))),128))],544),[[c,fe.value]])]),d("div",V,[we.value?(y(),s("div",M,[...a[9]||(a[9]=[d("div",{class:"loading-spinner"},null,-1),d("p",null,"加载中...",-1)])])):0===ke.value.length?(y(),s("div",U,[...a[10]||(a[10]=[h('<div class="empty-icon" data-v-1d499532><svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-1d499532><path d="M4 19.5C4 18.837 4.26339 18.2011 4.73223 17.7322C5.20107 17.2634 5.83696 17 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-1d499532></path><path d="M6.5 2H20V22H6.5C5.83696 22 5.20107 21.7366 4.73223 21.2678C4.26339 20.7989 4 20.163 4 19.5V4.5C4 3.83696 4.26339 3.20107 4.73223 2.73223C5.20107 2.26339 5.83696 2 6.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-1d499532></path></svg></div><div class="empty-text" data-v-1d499532><h3 data-v-1d499532>暂无图书数据</h3><p data-v-1d499532>点击&quot;添加图书&quot;按钮开始添加图书信息</p></div>',2)])])):(y(),s("div",B,[d("table",F,[a[11]||(a[11]=d("thead",null,[d("tr",null,[d("th",null,"图书编码"),d("th",null,"图书名称"),d("th",null,"作者"),d("th",null,"分类"),d("th",null,"状态"),d("th",null,"操作")])],-1)),d("tbody",null,[(y(!0),s(v,null,p(He.value,e=>{var a;return y(),s("tr",{key:e.id},[d("td",_,b(e.code),1),d("td",H,b(e.title),1),d("td",q,b(e.author),1),d("td",S,b((null==(a=e.category)?void 0:a.name)||"未分类"),1),d("td",P,[d("span",{class:k(["status-badge",e.status])},b("available"===e.status?"可借阅":"已借出"),3)]),d("td",T,[d("button",{class:"edit-button",onClick:a=>(e=>{var a;xe.value=!0,je.value=e,Fe.code=e.code,Fe.title=e.title,Fe.author=e.author,Fe.categoryId=(null==(a=e.category)?void 0:a.id)||"",Fe.description=e.description||"",De(),Ce.value=!0})(e)},"编辑",8,Z),d("button",{class:"delete-button",onClick:a=>(e=>{Le.value=e,Ie.value=!0})(e),disabled:"borrowed"===e.status},"删除",8,z)])])}),128))])])]))]),Ce.value?(y(),s("div",{key:0,class:"dialog-overlay",onClick:g(Se,["self"])},[d("div",A,[d("div",D,[d("h3",null,b(xe.value?"编辑图书":"添加图书"),1),d("button",{class:"close-button",onClick:Se},[...a[12]||(a[12]=[d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),d("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),d("div",E,[d("form",{onSubmit:g(Te,["prevent"])},[d("div",G,[a[13]||(a[13]=d("label",{for:"book-code"},"图书编码 *",-1)),u(d("input",{type:"text",id:"book-code","onUpdate:modelValue":a[2]||(a[2]=e=>Fe.code=e),placeholder:"请输入图书编码",disabled:Ve.value||xe.value&&"borrowed"===(null==(l=je.value)?void 0:l.status)},null,8,J),[[n,Fe.code]]),_e.code?(y(),s("span",K,b(_e.code),1)):i("",!0)]),d("div",N,[a[14]||(a[14]=d("label",{for:"book-title"},"图书名称 *",-1)),u(d("input",{type:"text",id:"book-title","onUpdate:modelValue":a[3]||(a[3]=e=>Fe.title=e),placeholder:"请输入图书名称",disabled:Ve.value||xe.value&&"borrowed"===(null==(o=je.value)?void 0:o.status)},null,8,O),[[n,Fe.title]]),_e.title?(y(),s("span",Q,b(_e.title),1)):i("",!0)]),d("div",R,[a[15]||(a[15]=d("label",{for:"book-author"},"作者 *",-1)),u(d("input",{type:"text",id:"book-author","onUpdate:modelValue":a[4]||(a[4]=e=>Fe.author=e),placeholder:"请输入作者姓名",disabled:Ve.value||xe.value&&"borrowed"===(null==(t=je.value)?void 0:t.status)},null,8,W),[[n,Fe.author]]),_e.author?(y(),s("span",X,b(_e.author),1)):i("",!0)]),d("div",Y,[a[17]||(a[17]=d("label",{for:"book-category"},"分类 *",-1)),u(d("select",{id:"book-category","onUpdate:modelValue":a[5]||(a[5]=e=>Fe.categoryId=e),disabled:Ve.value||xe.value&&"borrowed"===(null==(w=je.value)?void 0:w.status)},[a[16]||(a[16]=d("option",{value:"",disabled:""},"请选择分类",-1)),(y(!0),s(v,null,p(ye.value,e=>(y(),s("option",{key:e.id,value:e.id},b(e.name),9,ee))),128))],8,$),[[c,Fe.categoryId]]),_e.categoryId?(y(),s("span",ae,b(_e.categoryId),1)):i("",!0)]),d("div",le,[a[18]||(a[18]=d("label",{for:"book-description"},"描述（可选）",-1)),u(d("textarea",{id:"book-description","onUpdate:modelValue":a[6]||(a[6]=e=>Fe.description=e),placeholder:"请输入图书描述",rows:"3",disabled:Ve.value||xe.value&&"borrowed"===(null==(m=je.value)?void 0:m.status)},null,8,oe),[[n,Fe.description]])]),d("div",te,[d("button",{type:"button",class:"dialog-button secondary",onClick:Se,disabled:Ve.value},"取消",8,se),d("button",{type:"submit",class:"dialog-button primary",disabled:Ve.value||xe.value&&"borrowed"===(null==(f=je.value)?void 0:f.status)},[Ve.value?(y(),s("span",ie,"处理中...")):(y(),s("span",re,b(xe.value?"保存修改":"添加图书"),1))],8,de)])],32)])])])):i("",!0),Ie.value?(y(),s("div",{key:1,class:"dialog-overlay",onClick:g(Pe,["self"])},[d("div",ue,[d("div",{class:"dialog-header"},[a[20]||(a[20]=d("h3",null,"确认删除",-1)),d("button",{class:"close-button",onClick:Pe},[...a[19]||(a[19]=[d("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),d("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),d("div",ne,[d("p",ce,"您确定要删除图书《"+b(null==(C=Le.value)?void 0:C.title)+"》吗？",1),a[21]||(a[21]=d("p",{class:"delete-hint"},"此操作无法撤销，删除后数据将无法恢复。",-1))]),d("div",ve,[d("button",{class:"dialog-button secondary",onClick:Pe,disabled:Me.value},"取消",8,pe),d("button",{class:"dialog-button danger",onClick:Ze,disabled:Me.value},[Me.value?(y(),s("span",ge,"处理中...")):(y(),s("span",be,"确认删除"))],8,he)])])])):i("",!0),Ue.value?(y(),s("div",{key:2,class:k(["message-toast",Be.value])},b(Ue.value),3)):i("",!0)])}}},[["__scopeId","data-v-1d499532"]]);export{ke as default};
