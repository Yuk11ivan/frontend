import{_ as $,r as i,q,s as L,c as o,a as e,d as f,j as E,v as O,k as P,t as r,l as V,F as U,f as Z,w as j,n as H,o as l}from"./index-Cd1-5Fvb.js";import{d as A,r as G}from"./api-DS5VUnfc.js";const J={class:"return-container"},Q={key:0,class:"search-card"},W={class:"search-form"},X={class:"form-group"},Y=["disabled"],ee={key:0,class:"error-message"},te=["disabled"],se={key:0},oe={key:1},le={key:1,class:"records-section"},ne={class:"records-header"},ae={key:0,class:"loading-container"},re={key:1,class:"no-records"},ie={key:2,class:"records-container"},ue={class:"records-table-wrapper"},de={class:"records-table"},ce={class:"book-title"},ve=["disabled","onClick"],he={key:0},ke={key:1},pe={key:1,class:"returned-text"},ge={class:"records-summary"},we={class:"dialog-content"},fe={class:"dialog-body"},_e={class:"dialog-footer"},be=["disabled"],me={class:"dialog-content success-dialog"},ye={__name:"ReturnBook",setup(Ce){const u=i(""),v=q({phone:""}),h=i(!1),_=i(!1),d=i([]),S=i(!1),p=i(!1),b=i(!1),c=i(null),k=i(null),m=i(""),g=i(""),C=i("success"),I=L(()=>d.value.filter(s=>!s.returnDate).length),T=L(()=>d.value.filter(s=>!!s.returnDate).length),D=()=>{u.value?/^1[3-9]\d{9}$/.test(u.value)?v.phone="":v.phone="请输入有效的11位手机号":v.phone="请输入手机号"},x=async()=>{var s,t;if(D(),!(v.phone||!u.value))try{h.value=!0;const n=await A(u.value);d.value=n,_.value=!0}catch(n){R("查询失败: "+(((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"未知错误"),"error"),console.error("Failed to search records:",n)}finally{h.value=!1}},F=()=>{_.value=!1,d.value=[],u.value="",v.phone=""},N=s=>{c.value=s,p.value=!0},y=()=>{p.value=!1,c.value=null},z=async()=>{var s,t;if(c.value)try{k.value=c.value.id,await G(c.value.id),m.value=c.value.book.title,p.value=!1,b.value=!0;const n=d.value.findIndex(w=>w.id===c.value.id);n!==-1&&(d.value[n].returnDate=new Date().toISOString()),c.value=null}catch(n){R("归还失败: "+(((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"未知错误"),"error"),console.error("Failed to return book:",n)}finally{k.value=null}},B=()=>{b.value=!1,m.value=""},M=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",K=s=>{if(!s)return"";const t=new Date(s),n=new Date(t);return n.setDate(n.getDate()+30),n},R=(s,t="success")=>{g.value=s,C.value=t,setTimeout(()=>{g.value=""},3e3)};return(s,t)=>{var n,w;return l(),o("div",J,[t[11]||(t[11]=e("div",{class:"page-header"},[e("h1",null,"归还图书"),e("p",{class:"subtitle"},"请输入借阅时的手机号，查看并归还您的借阅图书")],-1)),_.value?(l(),o("div",le,[e("div",ne,[e("h2",null,"借阅记录 - "+r(u.value),1),e("button",{class:"back-button",onClick:F},[...t[3]||(t[3]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M19 12H5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),V(" 返回重新查询 ",-1)])])]),S.value?(l(),o("div",ae,[...t[4]||(t[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"加载中...",-1)])])):d.value.length===0?(l(),o("div",re,[...t[5]||(t[5]=[e("div",{class:"no-records-icon"},[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 17H5C3.89543 17 3 16.1046 3 15V4C3 2.89543 3.89543 2 5 2H14C15.1046 2 16 2.89543 16 4V15C16 16.1046 15.1046 17 14 17H10M16 17V19C16 20.1046 15.1046 21 14 21H10C8.89543 21 8 20.1046 8 19V17M9 17V13C9 11.8954 9.89543 11 11 11H13C14.1046 11 15 11.8954 15 13V17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),e("div",{class:"no-records-content"},[e("h3",null,"暂无借阅记录"),e("p",null,"未找到该手机号的借阅记录或所有图书已归还")],-1)])])):(l(),o("div",ie,[e("div",ue,[e("table",de,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",null,"图书编码"),e("th",null,"图书名称"),e("th",null,"借阅时间"),e("th",null,"预计归还时间"),e("th",null,"状态"),e("th",null,"操作")])],-1)),e("tbody",null,[(l(!0),o(U,null,Z(d.value,a=>(l(),o("tr",{key:a.id},[e("td",null,r(a.book.code),1),e("td",ce,r(a.book.title),1),e("td",null,r(M(a.borrowDate)),1),e("td",null,r(M(K(a.borrowDate))),1),e("td",{class:H("status-"+(a.returnDate?"returned":"borrowed"))},r(a.returnDate?"已归还":"借阅中"),3),e("td",null,[a.returnDate?(l(),o("span",pe,"已归还")):(l(),o("button",{key:0,class:"return-button",disabled:k.value===a.id,onClick:De=>N(a)},[k.value===a.id?(l(),o("span",he,"处理中...")):(l(),o("span",ke,"归还图书"))],8,ve))])]))),128))])])]),e("div",ge," 共 "+r(d.value.length)+" 条记录，其中 "+r(I.value)+" 条借阅中，"+r(T.value)+" 条已归还 ",1)]))])):(l(),o("div",Q,[e("div",W,[e("div",X,[t[1]||(t[1]=e("label",{for:"phone"},"手机号",-1)),E(e("input",{type:"tel",id:"phone","onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),placeholder:"请输入借阅时的手机号",maxlength:"11",disabled:h.value,onInput:D,onKeyup:P(x,["enter"])},null,40,Y),[[O,u.value]]),v.phone?(l(),o("span",ee,r(v.phone),1)):f("",!0)]),e("button",{class:"search-button",disabled:!u.value||v.phone||h.value,onClick:x},[h.value?(l(),o("span",se,"搜索中...")):(l(),o("span",oe,[...t[2]||(t[2]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M21 21L16.65 16.65M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),V(" 查询借阅记录 ",-1)])]))],8,te)])])),p.value?(l(),o("div",{key:2,class:"dialog-overlay",onClick:j(y,["self"])},[e("div",we,[e("div",{class:"dialog-header"},[t[8]||(t[8]=e("h3",null,"确认归还图书",-1)),e("button",{class:"close-button",onClick:y},[...t[7]||(t[7]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("div",fe,[e("p",null,"您确定要归还图书《"+r((w=(n=c.value)==null?void 0:n.book)==null?void 0:w.title)+"》吗？",1)]),e("div",_e,[e("button",{class:"dialog-button secondary",onClick:y},"取消"),e("button",{class:"dialog-button primary",onClick:z,disabled:k.value},"确认归还",8,be)])])])):f("",!0),b.value?(l(),o("div",{key:3,class:"dialog-overlay",onClick:j(B,["self"])},[e("div",me,[t[9]||(t[9]=e("div",{class:"success-icon-large"},[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t[10]||(t[10]=e("h3",null,"归还成功！",-1)),e("p",null,"感谢您及时归还图书《"+r(m.value)+"》",1),e("button",{class:"dialog-button primary large",onClick:B},"确定")])])):f("",!0),g.value?(l(),o("div",{key:4,class:H(["message-toast",C.value])},r(g.value),3)):f("",!0)])}}},Me=$(ye,[["__scopeId","data-v-9acea08f"]]);export{Me as default};
